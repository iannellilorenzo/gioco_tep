<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Chi vuol essere milionario!</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  </head>
  <body>
    <header class="head">
      <h1><a href="index.html">Chi vuol essere milionario!</a></h1>
    </header>
    <div class="container cont">
      <div style="text-align:center; padding-top: 20px">
        <h2>Ti sei unito alla partita</h2>
      </div>
      <div id="gioco">
        <div id="step1"> <!-- il gioco è gestito in step, dove ogni step corrisponde a una domanda, da -->
          <div class="question">
            <h4>Domanda:</h4>
            <div id="testoDomanda">
              <!-- qua viene scritto il testo della domanda grazie allo script -->
            </div>
          </div>
          <div id="risposte" class="d-flex flex-column align-items-center justify-content-center">
            <div class="row justify-content-around mb-2">
              <div class="col-sm-5 d-flex justify-content-center">
                <button class="risposta btn btn-warning rounded-pill btn-lg fixed-size-button" id="risposta1" onclick="answered(1)">Answer 1</button>
              </div>
              <div class="col-sm-5 d-flex justify-content-center">
                <button class="risposta btn btn-warning rounded-pill btn-lg fixed-size-button" id="risposta2" onclick="answered(2)">Answer 2</button>
              </div>
            </div>
            <div class="row justify-content-around">
              <div class="col-sm-5 d-flex justify-content-center">
                <button class="risposta btn btn-warning rounded-pill btn-lg fixed-size-button" id="risposta3" onclick="answered(3)">Answer 3</button>
              </div>
              <div class="col-sm-5 d-flex justify-content-center">
                <button class="risposta btn btn-warning rounded-pill btn-lg fixed-size-button" id="risposta4" onclick="answered(4)">Answer 4</button>
              </div>
            </div>
          </div>
        </div>
        <div class="modal fade" id="correctAnswerModal" tabindex="-1" role="dialog" aria-labelledby="correctAnswerModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
              <div class="modal-body">
                <h2 class="text-center">Risposta esatta!</h2>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <br><br><br>
    <footer>
      <div>© 2024 Chi vuol essere milionario! Tutti i diritti riservati.</div>
    </footer>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="../js/script.js"></script>
    <script>
      var stepId = 0; // stepId è l'id della domanda, zero-based, da cui traggo anche le risposte
      const minQuestionID = Math.floor(rng(1, 45)); // le domande vanno da 'minQuestionID' a 'minQuestionID + 15
      const maxQuestionID = minQuestionID + 15;

      function rng(min, max) {
        return Math.random() * (max - min) + min;
      }

      async function getQuestion() {
        const myHeaders = new Headers();
        myHeaders.append("Authorization", "Basic NElFOlRpcm9uaQ==");

        const requestOptions = {
          method: "GET",
          headers: myHeaders,
          redirect: "follow"
        };

        const gameId = await getGameID();
        const result = await fetch(`https://classe5ID.altervista.org/games/mossa/${gameId}/IANNELLI_milionario/`, requestOptions);
        const risultato = await result.json();
        risultato.data.play = minQuestionID;

        const path = "../assets/domande_risposte.json";

        const response = await fetch(path);
        const quest = await response.json();

        const questionsInRange = quest.slice(minQuestionID - 1, maxQuestionID - 1);
        document.getElementById("testoDomanda").innerText = questionsInRange[stepId].domanda;
        return questionsInRange;
      }

      $(document).ready(function() {
        async function getAnswers() {
          let supportArray = []; // array di supporto per la randomizzazione delle domande
          const questAnsw = await getQuestion();
          for (let i = 1; i <= 4; i++) {
            let answIndex;
            let randomNum;
            do {
              randomNum = Math.floor(rng(1, 5));
              answIndex = `risposta${randomNum}`;
            } while (supportArray.includes(randomNum));
            supportArray.push(randomNum);
            document.getElementById(`risposta${i}`).innerText = questAnsw[stepId][answIndex];
          }
        }

        getAnswers();
      });
      
      async function answered(answerId) {
        // se la risposta è corretta, passo alla domanda successiva
        const path = "../assets/domande_risposte.json";
        const response = await fetch(path);
        const quest = await response.json();

        const doc = document.getElementById(`risposta${answerId}`).innerText;

        if (quest[minQuestionID - 1].risposta1 === doc) {
          stepId++;
          $('#correctAnswerModal').modal('show');
          setTimeout(function() {
            $('#correctAnswerModal').modal('hide');
          }, 2000);
        }
      }
      
    </script>
  
    
  </body>
</html>